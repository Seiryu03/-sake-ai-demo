#!/bin/bash
# ğŸ›¡ï¸ APrise 100ç‚¹ãƒ‡ã‚¶ã‚¤ãƒ³ä¿è­·ãƒ•ãƒƒã‚¯
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯é‡è¦ãªãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’ç›£è¦–ãƒ»ä¿è­·ã—ã¾ã™

echo "ğŸ›¡ï¸  APrise Design Protection Hook - Checking for protected file modifications..."

# ä¿è­·å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
PROTECTED_FILES=(
    "public/index.html"
    "public/styles-v2.css"
)

# ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥ï¼ˆ100ç‚¹ãƒ‡ã‚¶ã‚¤ãƒ³ã®è¨¼æ˜ï¼‰
declare -A FILE_HASHES
FILE_HASHES["public/index.html"]="$(md5 -q public/index.html 2>/dev/null || md5sum public/index.html 2>/dev/null | cut -d' ' -f1)"
FILE_HASHES["public/styles-v2.css"]="$(md5 -q public/styles-v2.css 2>/dev/null || md5sum public/styles-v2.css 2>/dev/null | cut -d' ' -f1)"

# å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
MODIFIED_PROTECTED=()
for file in "${PROTECTED_FILES[@]}"; do
    if git diff --cached --name-only | grep -q "^$file$"; then
        MODIFIED_PROTECTED+=("$file")
    fi
done

# ä¿è­·ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆ
if [ ${#MODIFIED_PROTECTED[@]} -gt 0 ]; then
    echo ""
    echo "âš ï¸  DESIGN PROTECTION ALERT!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ğŸ¨ The following 100-point design files are protected:"
    for file in "${MODIFIED_PROTECTED[@]}"; do
        echo "   â€¢ $file"
    done
    echo ""
    echo "ğŸš¨ These files contain the perfected UI/UX design and should not be modified."
    echo "ğŸ’¡ If you absolutely need to make changes:"
    echo "   1. Create a backup: git stash"
    echo "   2. Override protection: git commit --no-verify"
    echo "   3. Or contact the design team for approval"
    echo ""
    echo "ğŸ† Current design status: 100/100 points"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    exit 1
fi

# ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆæ©Ÿèƒ½ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
if git diff --cached --name-only | grep -q "server.js\|package.json"; then
    echo "ğŸ” Checking chatbot functionality integrity..."
    
    # Node.jsã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯
    if ! node -e "console.log('Node.js check passed')" > /dev/null 2>&1; then
        echo "âŒ Node.js environment check failed"
        exit 1
    fi
    
    echo "âœ… Chatbot functionality integrity maintained"
fi

echo "âœ… All protected design files are safe"
echo "ğŸ¨ 100-point design integrity confirmed"
echo "ğŸš€ Proceeding with commit..."